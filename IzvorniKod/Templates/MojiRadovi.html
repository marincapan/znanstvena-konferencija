{% load static %}
<!DOCTYPE html>
    <html>
        <head>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <title>
              Moji radovi
            </title>
            <meta name="description" content="">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <link rel="icon" href="{% static '/vectors/icon.svg' %}">
            <link href="{% static '/css/bootstrap.min.css' %}" rel="stylesheet">
            <link href="{% static '/css/headers.css' %}" rel="stylesheet">
            <script src="{% static '/js/bootstrap.bundle.min.js' %}"></script>
        </head>

        <style>
          @media (min-width: 768px) {
            .bd-placeholder-img-lg {
              font-size: 3.5rem;
            }
          }

          /*Bitno za animaciju rotacije hamburger menija*/
          @keyframes rotation{
            from {transform: rotate(0deg);}
            to {transform: rotate(90deg);}
          }   
            .gradient-custom-3 {
              /* fallback for old browsers */
              background: #8fb5cc;
  
              /* Chrome 10-25, Safari 5.1-6 */
              background: -webkit-linear-gradient(to right, #f2f2f2, #8FB5CC);
  
              /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
              background: linear-gradient(to right, #f2f2f2, #8FB5CC);
            }
  
            .card {
              background-color: #f2f2f2;
            }

            .btn-primary {
                background-color: #1c3a9c;
                border-color: #1c3a9c;
            }

            .btn-primary:hover {
                background-color: #c1666b;
                border-color: #c1666b;
            }
            .btn-outline-primary:hover {
                background-color: #c1666b;
                border-color: #c1666b;
            }

            .list-group-item:hover {
                background-color: #8fb5cc;
                color: black;
                font-weight: bold;
            }

            .buttons {
                list-style-type: none;
            }

            input[type='radio'],input[type='checkbox'] { 
                transform: scale(1.25); 
            }

            .active-fields-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                align-items: center;
                text-align: center;
                justify-items: center;
            }

            button.acc-btn {
              display: grid;
              grid-template-columns: 1fr max-content max-content;
              align-items: center;
              grid-gap: 10px;
            }

          </style>


        <body style="min-width: 500px">

          <!--HEADER-->
          {% include "./Header.html" %}
          <!--HEADER--> 


            <div class="gradient-custom-3 " style="min-height: 100vh;">
              <div class="container pt-5 pb-5">
                <div class="card" style="border-radius: 15px;">
                  <div class="card-body p-5">


                    <div class="text-uppercase text-center mb-5">
                      <h2>Moji radovi</h2>
                      <hr>
                    </div>

                    <!--ZA FRONTEND - Vrlo je važno da id ovih elemenata ne mijenjate 
                      jer se java script na dnu referira na njih-->

                    <!--Klasika za error messages-->
                    {% if messages %}
                      {% for message in messages %}
                      <h4{% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</h4>
                      {% endfor %}
                    {% endif %}
                    
                    <div id="pregledRadova">
                      <div class="text-center mb-5">
                        <h3>Pregled radova</h3>
                      </div>

                      <div class="accordion" id="accordionRadovi">
                        {%for rad in fetchedRadovi%}
                        <div class="accordion-item">
                          <h2 class="accordion-header" id="header{{forloop.counter}}">
                            <button class="accordion-button collapsed fs-5 acc-btn" type="button"
                              data-bs-toggle="collapse" data-bs-target="#collapse{{forloop.counter}}"
                              aria-expanded="true" aria-controls="collapse{{forloop.counter}}">
                              <div style="overflow:hidden;white-space: nowrap; text-overflow: ellipsis;">
                                {{rad.naslov}}</div>
                              {%if rad.pdf == "" %}
                              <span class="badge bg-danger d-flex">Rad nije predan!</span>
                              {%elif rad.recenziranBool == 0%}
                              <span class="badge bg-warning d-flex">Rad nije recenziran.</span>
                              {%else%}
                              <span class="badge bg-success d-flex">Rad je recenziran.</span>
                              {%endif%}
                            </button>
                          </h2>
                          <div id="collapse{{forloop.counter}}" class="accordion-collapse collapse"
                            aria-labelledby="heading{{forloop.counter}}">
                            <div class="accordion-body">
                              <div class="container">
                                <div class="row">
                                  <div class="col-auto">
                                    <strong>Naslov:</strong> {{rad.naslov}}
                                  </div>
                                </div>
                                <div class="row justify-content-between">
                                  <div class="col-12 col-lg-4">
                                    <div>
                                      <strong>Sekcija:</strong>
                                      {{rad.radSekcija.naziv}}
                                    </div>
                                    <div>
                                      <strong>Autori:</strong>
                                      {%for autor in rad.autori.all%}
                                      </br>{{autor.ime}} {{autor.prezime}}
                                      {%endfor%}
                                    </div>
                                  </div>

                                  {%if rad.pdf == ""%}
                                  <!-- rad nije predan, ponudi predaju rada -->
                                  <div class="col-12 col-lg-6">
                                    <form action="/mojiradovi" method="POST" enctype="multipart/form-data">
                                      {% csrf_token %}
                                      <div class="row">
                                        <div class="col">
                                          <div class="form-floating">
                                            <input id="naslovPredanogRada" type="text" name="fileTitle"
                                              class="form-control" placeholder="Unesite naslov rada"
                                              value="{{rad.naslov}}" hidden required />
                                            <label for="naslovPredanogRada" hidden>Unesite naslov rada</label>
                                          </div>
                                        </div>
                                        <!-- align-self-start/center/end -->
                                        <div class="btn-group">
                                          <input class="form-control" type="file" name="uploadedFile"
                                            accept="application/pdf">
                                          <button type="submit" class="btn btn-outline-primary" name='DodajPDFPostojecem'
                                            style="grid-column: 2;">Predaj</button>
                                        </div>
                                      </div>
                                    </form>
                                  </div>
                                  {%else%}
                                  <div class="col-12 col-lg-2">
                                    <div class="btn-group-vertical">
                                      <a class="btn btn-primary" href="Radovi/{{rad.pdf}}" role="button">Otvori
                                        rad</a>
                                      <a class="btn btn-outline-primary" href="Radovi/{{rad.pdf}}" role="button"
                                        download="{{rad.naslov}}">Preuzmi rad</a>
                                    </div>
                                  </div>
                                  {%endif%}
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        {%endfor%}
                      </div>
                    </div>

                    <br>
                    <hr>
                    <br>

                    <div id="dodavanjeRada">
                      <div class="text-center mb-5">
                        <h3>Predaja dodatnog rada</h3>
                      </div>
                      <p class="text-center text-muted mt-5 mb-0">
                        Ovdje uneste ime, datoteku te autore dodatnog rada s kojim želite sudjelovati na konferenciji.
                      </p>

                      <br>

                      <form action="/mojiradovi" method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <div class="fs-5">Odaberite datoteku za unos:</div>
                        <div class="row">
                          <div class="col-md-8 mb-4">
                            <div class="form-floating">
                              <input id="naslovRada" type="text" name="fileTitle" class="form-control"
                                placeholder="Unesite naslov rada" required />
                              <label for="naslovRada">Unesite naslov rada</label>
                            </div>
                          </div>
                          <!-- align-self-start/center/end -->
                          <div class="col-md-4 mb-4 align-self-center">
                            <input class="form-control" type="file" name="uploadedFile" accept="application/pdf">
                          </div>
                        </div>

                        <div class="fs-5">Podaci o autorima:</div>
                        <div class="row">
  
                          <div id="autori" class="mb-2">

                            <div id="jedanAutor" class="mb-2">

                              <label class="form-label" for="" id="authorsLabel">1.</label>
                              <div id="autorIme" class="input-group col-md-10 col-10 mb-1">
                                <input type="text" id="autorFName0" name="autorFName0" aria-label="Ime" placeholder="Ime" class="form-control form-control-lg" required>
                                <input type="text" id="autorLName0" name="autorLName0" aria-label="Prezime" placeholder="Prezime" class="form-control form-control-lg" required>
                              </div>

                              <div id="autorPodaci" class="input-group col-md-10 col-10 mb-1">
                                <input type="text" id="autorEmail0" name="autorEmail0" aria-label="E-mail" placeholder="E-mail" class="form-control form-control-lg" required/>
                                <div id="autorPodaciKontakt" class="input-group-text">
                                  <input type="radio" id="autorKontakt0" name="autorKontakt0" aria-label="Kontakt" class="form-check-input form-check-lg" required/>
                                  <label class="form-check-label" id="autorKontaktLabel0" style="margin-top:4px; margin-left:4px"for="autorKontakt0">Osoba za kontakt</label>
                                </div>
                              </div>
                            </div>
                          </div>
                          
                          <div class="col-md-4 mb-4">
                            <button type="button" class="btn btn-primary btn-lg" id="btnDodajAutora" onclick=AddAuthor()>
                              <svg class="bi d-block mx-auto mb-1" width="24" height="24"><use xlink:href="#person-plus"/></svg>
                            </button>
                            <button type="button" class="btn btn-outline-primary btn-lg" id="btnMakniAutora" onclick=RemoveAuthor()>
                              <svg class="bi d-block mx-auto mb-1" width="24" height="24"><use xlink:href="#person-dash"/></svg>
                            </button>
                            <input type="number" min="0" name="brojAutora" id="brojAutora" class="form-control" value="1" hidden></input>
                          </div>          
                        </div>

                        {%if not pdf%}
                        <!-- nije predan niti jedan rad -->
                        <div class="row"
                          style="display: grid; grid-template-columns: 1fr 1fr 1fr; justify-items: center;">
                          <button type="submit" class="btn btn-secondary btn-lg" name='UploadFile'
                            style="grid-column: 2;" disabled>Predaj prvi rad prije predaje novog</button>
                        </div>
                        {%else%}
                        <div class="row"
                          style="display: grid; grid-template-columns: 1fr 1fr 1fr; justify-items: center;">
                          <button type="submit" class="btn btn-primary btn-lg" name='UploadFile'
                            style="grid-column: 2;">Predaj rad</button>
                        </div>
                        {%endif%}

                      </form>
                    </div>
                  </div>

                </div>
              </div>

            </div>

            <!--FOOTER-->
            {% include "./Footer.html" %}
            <!--FOOTER-->

        </body>

        <!-- Kopiraj ovaj dio javascripta za hamburger animacije -->
        <script type="text/javascript">
          var navbarCollapse = document.getElementById("navbarContent");
              
          navbarCollapse.addEventListener('show.bs.collapse', function(){
            document.getElementById("navbarTogglerIcon").style.animation="rotation 0.5s both";
          });
          navbarCollapse.addEventListener('shown.bs.collapse', function(){
            document.getElementById("navbarTogglerIcon").style.animation="none";
            document.getElementById("navbarTogglerIcon").style.transform="rotate(90deg)";
          });
          navbarCollapse.addEventListener('hide.bs.collapse', function(){
            document.getElementById("navbarTogglerIcon").style.animation="rotation 0.35s reverse";
          });
          navbarCollapse.addEventListener('hidden.bs.collapse', function(){
            document.getElementById("navbarTogglerIcon").style.animation="none";
            document.getElementById("navbarTogglerIcon").style.transform="rotate(0deg)";
          });

          function AddAuthor(){
              //prati broj autora (SO kaze da + cini ovo brojem)
              var brojAutora = +document.getElementById("brojAutora").value;

              //kloniramo prvog autora pa ga nastavljamo uredjivati
              var noviAutor = document.getElementById("autori").firstElementChild.cloneNode(true); 
              console.log(noviAutor);

              if(noviAutor.hasChildNodes()){
                var children = noviAutor.childNodes;

                //Prolazimo kroz svu djecu elementa
                for(var i = 0; i < children.length; i++){

                  //Obrada za redni broj autora
                  if(children[i].id == "authorsLabel"){
                    children[i].innerText = (brojAutora+1) + ".";
                    console.log("Tu sam");
                    console.log(children[i]);
                  }
                  //Obrada za ID-eve imena i prezimena
                  if(children[i].id == "autorIme"){
                    for(var j = 0; j < children[i].childNodes.length; j++){
                      if(children[i].childNodes[j].id == "autorFName0"){
                        children[i].childNodes[j].id = "autorFName" + brojAutora;
                        children[i].childNodes[j].name = "autorFName" + brojAutora;
                        children[i].childNodes[j].value = "";
                      }
                      if(children[i].childNodes[j].id == "autorLName0"){
                        children[i].childNodes[j].id = "autorLName" + brojAutora;
                        children[i].childNodes[j].name = "autorLName" + brojAutora;
                        children[i].childNodes[j].value = "";
                      }
                    }
                  }

                  //Obrada za ID-eve podataka o autoru
                  if(children[i].id == "autorPodaci"){
                    for(var j = 0; j < children[i].childNodes.length; j++){
                      //Obrada za Email
                      if(children[i].childNodes[j].id == "autorEmail0"){
                        children[i].childNodes[j].id = "autorEmail" + brojAutora;
                        children[i].childNodes[j].name = "autorEmail" + brojAutora;
                        children[i].childNodes[j].value = "";
                      }
                      //Obrada za kontakt radio button
                      if(children[i].childNodes[j].id == "autorPodaciKontakt"){
                        for(var k = 0; k < children[i].childNodes[j].childNodes.length; k++){
                          if(children[i].childNodes[j].childNodes[k].id == "autorKontakt0"){
                            children[i].childNodes[j].childNodes[k].id = "autorKontakt" + brojAutora;
                            children[i].childNodes[j].childNodes[k].checked = false; //Ako je prvi checkan i doda se novi vise novi nije checkan
                            //children[i].childNodes[j].childNodes[k].name = "autorKontakt" + brojAutora;
                          }
                          if(children[i].childNodes[j].childNodes[k].id == "autorKontaktLabel0"){
                            children[i].childNodes[j].childNodes[k].id = "autorKontaktLabel" + brojAutora;
                            children[i].childNodes[j].childNodes[k].htmlFor = "autorKontakt" + brojAutora;
                            console.log(children[i].childNodes[j].childNodes[k])
                          }
                        }
                      }
                    }
                  }

                }
              }

              //Dodavanje novog autora kao child element u div s autorima
              document.getElementById("autori").appendChild(noviAutor);

              //Povecavanje brojaca
              document.getElementById("brojAutora").value = brojAutora + 1;

              if(brojAutora + 1 > 1){
                document.getElementById("btnMakniAutora").disabled = false;
              }
            }

            function RemoveAuthor(){
              //prati broj autora (SO kaze da + cini ovo brojem)
              var brojAutora = +document.getElementById("brojAutora").value;

              //micemo zadnjeg dodanog autora
              document.getElementById("autori").removeChild(document.getElementById("autori").lastElementChild); 

              //Smanjivanje brojaca
              document.getElementById("brojAutora").value = brojAutora - 1;

              //Ako ima samo jedan autor zabrani brisanje
              if(brojAutora - 1 == 1){
                document.getElementById("btnMakniAutora").disabled = true;
              }
            }
        </script>
  
    </html>